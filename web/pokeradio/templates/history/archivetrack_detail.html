{% extends 'base.html' %}

{% block container %}
<header class="Header--page">
    <h1>{{ object.name }} - {{ object.artist.name }}</h1>
</header>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<div class="row">
    {% for o in count %}
    {{o}}
    {% endfor %}
    <script>
var data = JSON.parse('{{ time_series|safe }}');
// Metric
$(document).ready(function() {
$('.js-report-sparkline').each(function(sparklineId) {



  	var th = $(this);

        // Instead of splitting with "," we are passing the data in JSON format
        // Because splitting may cause getting datas as string
        // And that breaks scale calculators
        // Also this chain clears the HTML content
        var parseDate = d3.time.format("%m-%Y");

        data.forEach(function(d) {
            d.date = parseDate.parse(d.date);
            d.value = +d.value;
            console.log(d.date)
        });


        // Get width and height of the container
        var w = th.width(),
        h = th.height(),

        // Setting the margins
        // You may set different margins for X/Y
        xMargin = 30,
        yMargin = 20,

        // Scale functions
        // Setting the range with the margin
        y = d3.scale.linear()
                    .domain([0, 10])
                    .range([h - yMargin, yMargin]),
        x = d3.time.scale()
        					 .domain(d3.extent(data, function(d) { return d.date; }))
                    .range([xMargin, w - xMargin]),

        // Scale functions for creating the gradient fill/stroke
        // Calculating the color according to data in the range of colors
        // That user has passed with the data-range-[high-low]-color attributes
        gradientY = d3.scale.linear()
                            .domain([0,1,2,3,4,5,6,7]) .range(['#e86e6b','#e86e6c','#fcd56b','#59d1ba','#59d1bb','#a5d36e']),
        // This is a different margin than the one for the chart
        // Setting the gradient stops from 0% to 100% will cause wrong color ranges
        // Because data points are positioned in the center of containing rect
        percentageMargin = 100 / data.length,
        percentageX = d3.scale.linear()
                              .domain([0, data.length - 1])
                              .range([percentageMargin, 100 - percentageMargin]),

        // Create S
        container = d3.select(this).append("div"),

        // Create SVG object and set dimensions
        vis = container
            .append("svg:svg")
            .attr("width", w)
            .attr("height", h)



        g = vis.append("svg:g")
                .attr("stroke", "url(#sparkline-gradient-" + sparklineId + ")")
                .attr("fill", "url(#sparkline-gradient-" + sparklineId + ")"),


        // Create the line
        // Using cardinal interpolation because we need
        // The line to pass on every point
        area = d3.svg.area()
          .interpolate("cardinal")
        	.x(function(d,i) { return x(d.date); })
          .y0(h)
          .y1(function(d) { return y(d.value); }),
        line = d3.svg.line()
            .interpolate("cardinal")
            .x(function(d) { return x(d.date); })
            .y(function(d) { return y(d.value); });




  g.append("svg:path").attr("class","area").attr("d", area(data)).attr("style", "fill:url(#area-fill)");

  		 // Create points
        // We are only creating points for first and last data
          // Because that looks cooler :)
       var points = g.selectAll(".point")
            .data(data)
            .enter().append("svg:circle")
            .attr("class", function(d, i) { return (i === (data.length - 1) || i === 0) ? "point end" : "point"; })
            .attr("cx", function(d, i) { return x(d.date) })
            .attr("cy", function(d, i) { return y(d.value) })
            .attr("r",  function(d, i) { return (i === (data.length - 1) || i === 0) ? 5 : 3; });

    // Append the line to the group
    g.append("svg:path").attr("d", line(data));

    // Create the gradient effect
    // This is where the magic happens
    // We get datas and create gradient stops with calculated colors
    var defs = vis.append("svg:defs");
    defs.append("svg:linearGradient")
        .attr("id", "sparkline-gradient-" + sparklineId)
        .attr("x1", "0%").attr("y1", "0%").attr("x2", "100%").attr("y2", "0%")
        .attr("gradientUnits", "userSpaceOnUse")
        .selectAll(".gradient-stop")
        .data(data)
        .enter()
        .append("svg:stop").attr('offset', function(d, i) {
            return ((percentageX(i))) + "%";
        }).attr("style", function(d) {
            return "stop-color:" + gradientY(d.value) + ";stop-opacity:1";
        });

});
});
    </script>
    <div class="js-report-sparkline"></div>
</div>


<style type="text/css">
body {
  background: #333;
}

.x-axis .tick {
    stroke: white;
    opacity: .25 !important;
}
.x-axis .tick line {
    stroke: white;
    opacity: 0 !important;
}
.y-axis .tick:first-child {
    stroke: white;
    opacity: 0 !important;
}
.x-axis path {
    stroke-width: 2 !important;
  /* opacity: .75; */
}

.y-axis .tick {
    stroke: white;
    opacity: 0.25 !important;
}
.y-axis .tick:first-child {
    stroke: white;
}
.y-axis path {
    stroke-width: 0;
    opacity: 0 !important;
}
.y-axis .tick text {
  font-size: 12px;
}

.x-axis .tick text {
  font-size: 12px;
}

.js-report-sparkline {
  width: 708px;
  height: 250px;
  margin: 50px auto;
  font-family: "Proxima Nova", sans-serif;
  position: relative;

  * {
    box-sizing: border-box;
  }

  g {
  }

  path {
    stroke-width: 3;
    fill: none;
  }
  path.area {
    stroke-width: 0;
    fill: red;
  }

  .point {
    stroke-width: 2;
    transition: all .3s;
    opacity:0;
  }
  .point.end {
    opacity:1;
  }

  .bar-rect {
    fill: transparent;
    stroke: none;
  }

  .point.hover {
    stroke-width: 7;
    opacity:1;
  }
  .point.end.hover {
    stroke-width: 5;
    opacity: 1;
  }

  .chart-container {
    position: relative;
  }

  .chart-tooltip {
    position: absolute;
    background: white;
    color: #999;
    left: 0;
    /* display: none; */
    padding: 6px 8px 5px 8px;
    font-size: 12px;
    font-weight: 600;
    border-radius: 3px;
    margin-left: -8px;
    opacity: 0;
    -webkit-transition: .25s;


    .title {
      z-index: 3;
      text-transform: uppercase;
      font-size: 13px;
    }
  }

  .chart-tooltip.hover {
    margin-top: -10px;
    opacity: 1;
  }

  .chart-tooltip:after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    width: 0;
    height: 0;
    border: 5px solid transparent;
    border-top: 5px solid white;
  }

  .bullet {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: block;
    position: absolute;
    right: 5px;
    top: 13px;
  }
}
</style>
{% endblock %}

